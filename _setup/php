-- $db = new PDO('mysql:host=localhost;dbname=sa_webapp;charset=utf8mb4', 'dramelon', 'dramelon', [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]);

CREATE DATABASE sa_webapp
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_general_ci;

USE sa_webapp;




-- STAFFS (aka: user) v3
CREATE TABLE staffs (
    StaffID     INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    Username    VARCHAR(100) NOT NULL UNIQUE,
    Email       VARCHAR(255) DEFAULT NULL UNIQUE,
    Password    VARCHAR(100) NOT NULL,
    FullName    VARCHAR(255) DEFAULT NULL,
    Phone       VARCHAR(30)  DEFAULT NULL,
    AvatarPath  VARCHAR(255) DEFAULT NULL,
    Role        VARCHAR(30)  NOT NULL DEFAULT 'staff',

    LastLogin   DATETIME     DEFAULT NULL,
    created_at  TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Note        TEXT         DEFAULT NULL,
    Status      ENUM('active','inactive','suspended') NOT NULL DEFAULT 'active'
);




-- ANNOUNCEMENT (aka: news/announcements) v2
CREATE TABLE announcements (
    AnnounceID   INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Topic        VARCHAR(255) NOT NULL,
    Description  TEXT         NOT NULL,
    AnnounceDate DATETIME     NOT NULL DEFAULT CURRENT_TIMESTAMP,
    Announcer    INT UNSIGNED NULL,
    Status       ENUM('active','archived') NOT NULL DEFAULT 'active'
);




-- AUDITLOGS v1
CREATE TABLE audit (
    AuditID    BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    EntityType ENUM(
        'staff', 'location', 'customer', 'supplier', 'warehouse',
        'item', 'item_unit', 'item_category',
        'event',
        'request', 'rfq', 'quotation', 'po', 'deliveryin', 'deliveryout', 'receipt',' otherdocs',
        'announcement'
        ) NOT NULL,
    EntityID   BIGINT UNSIGNED NOT NULL,
    Action     ENUM('CREATE', 'UPDATE', 'ARCHIVE', 'UNARCHIVED', 'DELETE') NOT NULL,
    Reason     TEXT DEFAULT NULL,
    ActionAt   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ActionBy   INT UNSIGNED DEFAULT NULL
);




-- LOCATIONS v3
CREATE TABLE locations (
    LocationID      BIGINT UNSIGNED  NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RefLocationID   VARCHAR(30)      DEFAULT NULL UNIQUE,
    LocationName    VARCHAR(255)     NOT NULL,
    Email           VARCHAR(255)     DEFAULT NULL,
    Phone           VARCHAR(30)      DEFAULT NULL,
    Village         VARCHAR(30)      DEFAULT NULL,
    HouseNumber     VARCHAR(30)      DEFAULT NULL,
    BuildingName    VARCHAR(255)     DEFAULT NULL,
    Room            VARCHAR(30)      DEFAULT NULL,
    Floor           VARCHAR(30)      DEFAULT NULL,
    Street          VARCHAR(255)     DEFAULT NULL,
    Subdistrict     VARCHAR(255)     DEFAULT NULL,
    District        VARCHAR(255)     DEFAULT NULL,
    Province        VARCHAR(30)      DEFAULT NULL,
    Country         VARCHAR(255)     DEFAULT NULL,
    PostalCode      VARCHAR(30)      DEFAULT NULL,

    Note            TEXT             DEFAULT NULL,
    Status          ENUM('active','inactive') NOT NULL DEFAULT 'active'
);




-- CUSTOMERS v3
CREATE TABLE customers (
    CustomerID      BIGINT UNSIGNED  NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RefCustomerID   VARCHAR(30)      DEFAULT NULL UNIQUE,
    CustomerName    VARCHAR(255)     NOT NULL,
    LocationID      BIGINT UNSIGNED  DEFAULT NULL,
    OrgName         VARCHAR(255)     DEFAULT NULL,
    Email           VARCHAR(255)     DEFAULT NULL,
    Phone           VARCHAR(30)      DEFAULT NULL,
    TaxID           VARCHAR(30)      DEFAULT NULL,
    ContactPerson   VARCHAR(255)     DEFAULT NULL,

    Notes           TEXT             DEFAULT NULL,
    Status          ENUM('active','inactive') NOT NULL DEFAULT 'active'
);




-- SUPPLIERS v2
CREATE TABLE suppliers (
    SupplierID      BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RefSupplierID   VARCHAR(30) DEFAULT NULL UNIQUE,
    LocationID      BIGINT UNSIGNED DEFAULT NULL,
    SupplierName    VARCHAR(255) NOT NULL,
    OrgName         VARCHAR(255) DEFAULT NULL,
    ContactPerson   VARCHAR(255) DEFAULT NULL,
    Email           VARCHAR(255) DEFAULT NULL,
    Phone           VARCHAR(30)  DEFAULT NULL,
    TaxID           VARCHAR(30)  DEFAULT NULL,

    Note            TEXT         DEFAULT NULL,
    Status          ENUM('active','inactive') NOT NULL DEFAULT 'active'
);




-- WAREHOUSE v2
CREATE TABLE warehouse (
    WarehouseID    BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    LocationID     BIGINT UNSIGNED NOT NULL,
    WarehouseName  VARCHAR(255) NOT NULL,
    WarehouseSN    VARCHAR(255) DEFAULT NULL UNIQUE,

    Note           TEXT DEFAULT NULL,
    Status         ENUM('active','inactive') NOT NULL DEFAULT 'active'
);




-- EVENTS v4
CREATE TABLE events (
    EventID      BIGINT UNSIGNED  NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RefEventID   VARCHAR(30)      DEFAULT NULL UNIQUE,
    EventName    VARCHAR(255)     NOT NULL,
    StaffID      INT UNSIGNED     DEFAULT NULL,
    CustomerID   BIGINT UNSIGNED  DEFAULT NULL,
    LocationID   BIGINT UNSIGNED  DEFAULT NULL,
    StartDate    DATETIME         DEFAULT NULL,
    EndDate      DATETIME         DEFAULT NULL,
    
    Description  TEXT             DEFAULT NULL,
    Notes        TEXT             DEFAULT NULL,
    Status       ENUM('draft','planning','waiting','processing','billing','completed','cancelled') NOT NULL DEFAULT 'draft'
);




-- ITEMCATEGORY v2
CREATE TABLE itemcategorys (
    ItemCategoryID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    Name           VARCHAR(255)    NOT NULL,
    Note           TEXT            DEFAULT NULL
);




-- ITEMS v2
CREATE TABLE items (
    ItemID          BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RefItemID       VARCHAR(30)     DEFAULT NULL UNIQUE,
    ItemName        VARCHAR(255)    NOT NULL,
    ItemType        ENUM('อุปกร','วัสดุ','บริการ','') NULL DEFAULT 'อุปกร',
    ItemCategoryID  BIGINT UNSIGNED DEFAULT NULL,
    Brand           VARCHAR(255)    DEFAULT NULL,
    Model           VARCHAR(255)    DEFAULT NULL,
    UOM             VARCHAR(30)     NULL DEFAULT 'unit',
    Rate            DECIMAL(10,2)   DEFAULT NULL,
    Period          ENUM('ต่อชั่วโมง','ต่อวัน','ต่ออีเว้น') NOT NULL DEFAULT 'ต่อวัน',

    Note            TEXT            DEFAULT NULL,
    Status          ENUM('active','inactive') NOT NULL DEFAULT 'active'
);




-- ITEM_UNIT v2
CREATE TABLE item_units (
    ItemUnitID       BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    SerialNumber     VARCHAR(255) DEFAULT NULL UNIQUE,
    ItemID           BIGINT UNSIGNED NOT NULL,
    WarehouseID      BIGINT UNSIGNED DEFAULT NULL,
    SupplierID       BIGINT UNSIGNED DEFAULT NULL,
    OwnerShip        ENUM('company','rented','') NULL DEFAULT 'company',
    ConditionIn      ENUM('good','damaged','') NULL DEFAULT 'good',
    ConditionOut     ENUM('good','damaged','') NULL DEFAULT 'good',
    ExpectedReturnAt DATETIME DEFAULT NULL,
    ReturnAt         DATETIME DEFAULT NULL,

    Note             TEXT DEFAULT NULL,
    Status           ENUM('useable','in use','pending booking','booked','damaged','reparing','delivering','returned','archived') NOT NULL DEFAULT 'useable'
);




-- REQUESTS v2
CREATE TABLE requests (
    RequestID     BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RefRequestID  VARCHAR(255) DEFAULT NULL UNIQUE,
    RequestName   VARCHAR(255) NOT NULL,
    EventID       BIGINT UNSIGNED NOT NULL,
    RequestSeqNo  INT UNSIGNED NOT NULL,

    Note          TEXT DEFAULT NULL,
    Status        ENUM('draft','submitted','approved','closed','cancelled') NOT NULL DEFAULT 'draft'
);

-- REQUEST_LINES v2
CREATE TABLE request_lines (
    RequestLineID      BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RequestID          BIGINT UNSIGNED NOT NULL,
    LineNo             INT UNSIGNED NOT NULL,
    ItemID             BIGINT UNSIGNED NOT NULL,
    QuantityRequested  INT UNSIGNED NOT NULL,
    StartTime          DATETIME NOT NULL,
    EndTime            DATETIME NOT NULL,
    FulfillmentStatus  ENUM('pending','partial','fulfilled','cancelled') NOT NULL DEFAULT 'pending',

    Note               TEXT DEFAULT NULL,
    Status             ENUM('active','deleted') NOT NULL DEFAULT 'active'
);




-- BOOKING (aka: item schedule) v2
CREATE TABLE booking (
    BookingID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RequestAllocationID BIGINT UNSIGNED NOT NULL,
    ItemUnitID BIGINT UNSIGNED NOT NULL,
    StartTime DATETIME NOT NULL,
    EndTime DATETIME NOT NULL,
    ExpireAt DATETIME NULL,
    CancelReason TEXT DEFAULT NULL,

    Note TEXT DEFAULT NULL,
    Status ENUM('reserved','checked_out','in_use','returned','cancelled','expired') NOT NULL DEFAULT 'reserved'
);